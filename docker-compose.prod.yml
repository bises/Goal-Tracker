services:
  api:
    image: ghcr.io/${GITHUB_REPO_OWNER}/goal-tracker-api:latest
    container_name: goal-tracker-api
    ports:
      - "3001:3000"
    environment:
      DATABASE_URL: ${DATABASE_URL}
      PORT: ${PORT:-3000}
      NODE_ENV: production
      USE_HTTPS: ${USE_HTTPS:-false}
      SSL_CERT_PATH: ${SSL_CERT_PATH:-/certs/cert.crt}
      SSL_KEY_PATH: ${SSL_KEY_PATH:-/certs/cert.key}
    volumes:
      - /opt/certs:/certs:ro
    networks:
      - immich-net
    external_links:
      - immich_postgres:postgres
    restart: unless-stopped

  web:
    image: ghcr.io/${GITHUB_REPO_OWNER}/goal-tracker-web:latest
    container_name: goal-tracker-web
    ports:
      - "5137:80"
      - "5138:443"
    volumes:
      - /opt/certs:/certs:ro
    depends_on:
      - api
    restart: unless-stopped

networks:
  immich-net:
    external: true
